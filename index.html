javascript:(()=>{const css=`.rsvp__backdrop{position:fixed;inset:0;background:#000c;backdrop-filter:blur(2px);z-index:9999999;display:grid;place-items:center}.rsvp__card{background:#080808;border:1px solid #222;border-radius:16px;box-shadow:0 10px 40px #0007;width:min(900px,92vw);height:min(420px,70vh);display:grid;grid-template-rows:auto 1fr auto;overflow:hidden}.rsvp__head,.rsvp__foot{padding:10px 12px;background:#0b0b0b;border-bottom:1px solid #111}.rsvp__foot{border-top:1px solid #111;border-bottom:none;display:flex;gap:8px;align-items:center;flex-wrap:wrap}.rsvp__stage{position:relative;display:grid;place-items:center;background:#080808}.rsvp__word{font:48px Arial, sans-serif;color:#fff;line-height:1.1;letter-spacing:.02em}.rsvp__line{position:absolute;top:12%;bottom:12%;left:50%;width:1px;background:#222;transform:translateX(-50%)}.rsvp__btn{background:#111;color:#fff;border:1px solid #222;border-radius:8px;padding:6px 10px;cursor:pointer}.rsvp__muted{color:#9a9a9a;font:12px Arial, sans-serif}.rsvp__range{width:160px}`;function injectCSS(c){const s=document.createElement('style');s.textContent=c;document.head.appendChild(s)}function tokenize(t){t=t.replace(/\r\n?/g,'\n').replace(/[ \t]+/g,' ');const parts=t.split(/(\n{2,}|[^\S\r\n]+)/).filter(Boolean);const out=[];for(const p of parts){if(/\n{2,}/.test(p)){out.push('\n\n');continue}if(/^\s+$/.test(p))continue;const lines=p.split('\n');for(let i=0;i<lines.length;i++){const line=lines[i].trim();if(!line)continue;out.push(...(line.match(/[^\s]+/g)||[]));if(i<lines.length-1)out.push('\n\n')}}return out}function orpIndex(w){const core=w.replace(/^[^A-Za-z0-9]+|[^A-Za-z0-9]+$/g,'');if(!core)return 0;return Math.min(core.length-1,Math.max(0,Math.floor(core.length*.35)))}function esc(s){return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}const sel=window.getSelection&&String(window.getSelection());let text=sel&&sel.trim()?sel:document.body.innerText.slice(0,200000);if(!text){alert('No text found. Select some text first.');return}injectCSS(css);const root=document.createElement('div');root.className='rsvp__backdrop';root.innerHTML=`<div class="rsvp__card" role="dialog" aria-label="RSVP Reader"><div class="rsvp__head"><span class="rsvp__muted">Press & hold anywhere in the box to play • Release to pause • Space toggles</span></div><div class="rsvp__stage" tabindex="0"><div class="rsvp__line"></div><div class="rsvp__word">Ready</div></div><div class="rsvp__foot"><button class="rsvp__btn" data-act="back5">⏮ 5s</button><button class="rsvp__btn" data-act="back1">⏪ 1s</button><button class="rsvp__btn" data-act="fwd1">⏩ 1s</button><button class="rsvp__btn" data-act="fwd5">⏭ 5s</button><label class="rsvp__muted">WPM <input class="rsvp__range" type="range" min="300" max="1000" step="100" value="300"></label><select class="rsvp__btn" data-font><option>Arial, sans-serif</option><option>'Atkinson Hyperlegible', Arial, sans-serif</option><option>ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto</option><option>ui-monospace, SFMono-Regular, Menlo, Consolas</option></select><button class="rsvp__btn" data-act="close">Close</button><span class="rsvp__muted" data-eta>0% • 0:00 / 0:00</span></div></div>`;document.body.appendChild(root);const stage=root.querySelector('.rsvp__stage'), wordEl=root.querySelector('.rsvp__word'), wpmEl=root.querySelector('input[type=range]'), etaEl=root.querySelector('[data-eta]'), fontSel=root.querySelector('[data-font]');let tokens=tokenize(text),i=0,playing=false,raf=null,nextAt=0,lastTS=0;function base(){return 60000/Math.max(100,Number(wpmEl.value||300))}function delay(tok){let m=1;if(/[,;]/.test(tok))m*=1.2;if(/:/.test(tok))m*=1.3;if(/[.!?]/.test(tok))m*=1.6;if(/\n{2,}/.test(tok))m*=2;const extra=tok.replace(/^\W+|\W+$/g,'').length>8?15:0;return base()*m+extra}function render(k){const t=tokens[k]||'';const trimmed=t.trim();const lead=trimmed.match(/^[^A-Za-z0-9]+/)?.[0]??'',trail=trimmed.match(/[^A-Za-z0-9]+$/)?.[0]??'';const core=trimmed.slice(lead.length,trimmed.length-trail.length);const oi=orpIndex(core);const before=core.slice(0,oi),pivot=core.charAt(oi)||'',after=core.slice(oi+1);wordEl.innerHTML=`${esc(lead)}${esc(before)}<span style="color:#66d9ef">${esc(pivot)}</span>${esc(after)}${esc(trail)}`;wordEl.style.fontFamily=fontSel.value;const pct=tokens.length?((k+1)/tokens.length)*100:0;const elapsed=elapsedMs(k),total=totalMs();etaEl.textContent=`${Math.floor(pct)}% • ${fmt(elapsed)} / ${fmt(total)}`}function totalMs(){return tokens.reduce((a,t)=>a+delay(t),0)}function elapsedMs(k){let ms=0;for(let j=0;j<k;j++)ms+=delay(tokens[j]);return ms}function fmt(ms){const s=Math.round(ms/1000),m=Math.floor(s/60),ss=String(s%60).padStart(2,'0');return `${m}:${ss}`}function play(){if(!tokens.length||playing)return;playing=true;lastTS=0;nextAt=0;loop()}function pause(){playing=false;if(raf)cancelAnimationFrame(raf);raf=null;nextAt=0;lastTS=0}function loop(ts=0){if(!playing)return;if(!lastTS){lastTS=ts;render(i);nextAt=ts+delay(tokens[i])}if(ts>=nextAt){i=Math.min(tokens.length-1,i+1);render(i);nextAt=ts+delay(tokens[i])}raf=requestAnimationFrame(loop)}function seekMs(d){const target=Math.max(0,Math.min(totalMs(),elapsedMs(i)+d));let lo=0,hi=tokens.length-1;while(lo<hi){const mid=(lo+hi)>>1;elapsedMs(mid)<target?lo=mid+1:hi=mid}i=lo;render(i);if(playing){lastTS=0;nextAt=0}}root.addEventListener('click',e=>{const act=e.target?.dataset?.act;if(act==='close'){pause();root.remove();}if(act==='back1')seekMs(-1000);if(act==='back5')seekMs(-5000);if(act==='fwd1')seekMs(+1000);if(act==='fwd5')seekMs(+5000)});wpmEl.addEventListener('input',()=>render(i));fontSel.addEventListener('change',()=>render(i));stage.addEventListener('pointerdown',e=>{e.preventDefault();play();stage.setPointerCapture(e.pointerId)});stage.addEventListener('pointerup',e=>{e.preventDefault();pause();stage.releasePointerCapture(e.pointerId)});stage.addEventListener('pointercancel',pause);stage.addEventListener('pointerleave',pause);stage.addEventListener('keydown',e=>{if(e.code==='Space'){e.preventDefault();playing?pause():play()}if(e.code==='ArrowRight')seekMs(+500);if(e.code==='ArrowLeft')seekMs(-500)});render(0)})();
